---
title: "Team andRew"
date: "04/04/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## MRes Hackathon! 4/4/19

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(ggthemes)
library(gganimate)
library(skimr)
```

```{r}
url1 <- "https://query.data.world/s/tw3oaknxjlqods27xzzbpa3do4rmfr"
p1f <- tempfile()
download.file(url1, p1f, mode="wb")
happy_data <- read_excel(path = p1f)
```

Peek at the data and summarise three variables

```{r}
str(happy_data)

happy_data %>% 
  select(`Life Ladder`, 
          `Healthy life expectancy at birth`, 
          `Confidence in national government`) %>% 
  skim()
```

Some summary data
Plot data from the top 20 happiest countries in 2016

```{r}
happy_data %>% 
  group_by(country) %>%
  filter(!is.na(`Life Ladder`) & year == 2016) %>%
  summarise(score = `Life Ladder`) %>%
  mutate(country = reorder(country, score)) %>%
  top_n(20) %>%
  ggplot(aes(x = score, y = country)) + 
  geom_point() +
  labs(x = "Happiness Index Score", y = "Country", title = "Top 20 Happiest Countries in 2016") +
  theme_tufte() 
```

Select 6 countries fairly randomly and plot boxplot of Healthy life expectancy at birth

```{r}
country_list <- c("United Kingdom", "France", "Germany", "Italy", "Norway", "United States")

happy_data %>% 
  filter(country %in% country_list) %>%
  filter(!is.na(`Healthy life expectancy at birth`)) %>%
  mutate(score = `Healthy life expectancy at birth`) %>%
  mutate(country = reorder(country, score)) %>%
  ggplot(aes(y = score, x = country, fill = country)) + 
  geom_boxplot(width = .5) +
  labs(y = "Boxplot of Life Expectancy at Birth", x = "Country", title = "Life Expectancy at Birth") +  
  guides(fill = FALSE) + 
  coord_flip() +
  theme_tufte()
```

Now boxplot Life Ladder (Happiness Index) score

```{r}
happy_data %>% 
  filter(country %in% country_list) %>%
  group_by(country) %>%
  mutate(score = `Life Ladder`) %>%
  ungroup() %>%
  mutate(country = reorder(country, score)) %>%
  ggplot(aes(x = country, y = score)) + 
  geom_boxplot() +
  labs(x = "Country", y = "Happiness Index Score", title = "Happiness Index for 6 Countries") +
  coord_flip() +
  theme_fivethirtyeight() 
```

Histogram of Life Ladder measure

```{r}
happy_data %>% 
  group_by(country) %>%
  ggplot(aes(x = `Life Ladder`)) + 
  geom_histogram() + 
  theme_fivethirtyeight() +
  labs(x = "Happiness Index Score", y = "Count", title = "Histogram of Happiness Index Scores") 
```

Line plot faceted by Year for 6 Countries

```{r}
happy_data %>%
  filter(country %in% country_list) %>%
  group_by(year) %>%
  filter(!is.na(`Life Ladder`)) %>%
  ggplot(aes(x = year, y = `Life Ladder`)) +
  geom_line() +
  facet_wrap(~ country) +
  labs(x = "Year", y = "Happiness index", title = "Happiness Index over Time for 6 Countries") +
  theme_fivethirtyeight() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

A bit of an animation

```{r}
country_list <- c("United Kingdom", "France", "Germany", "Italy", "United States")

happy_data %>%
  filter(country %in% country_list) %>%
  filter(!is.na(`Life Ladder`)) %>%
  filter(year > 2007) %>%
  ggplot(aes(x = `Life Ladder`, y = country, colour = country)) +
  geom_point(size = 10) +
  labs(x = "Happiness Index", y = "Country", title = "Happiness Index over Time for 5 Countries \nfrom 2008 to 2016 in Year {closest_state}") +
  theme_fivethirtyeight() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(text = element_text(size = 10)) +
  guides(colour = FALSE) +
  transition_states(states = year, transition_length = 1, state_length = 1) 
```

